<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TextGuard - Premium Plagiarism Checker</title>
  <style>
    :root{--bg-1:#0f172a;--bg-2:#1e293b;--accent-1:#3b82f6;--accent-2:#06b6d4;--muted:#94a3b8;--card-bg:rgba(255,255,255,0.98);--text-dark:#0f172a;--radius:12px;--shadow-sm:0 6px 24px rgba(0,0,0,0.12);--max-width:1400px}
    *{box-sizing:border-box;margin:0;padding:0}html,body{height:100%}
    body{font-family:Inter,system-ui,Segoe UI,Arial;background:linear-gradient(135deg,var(--bg-1) 0%,var(--bg-2) 50%,#0f4c75 100%);color:var(--text-dark);min-height:100vh;display:flex;flex-direction:column}
    nav{position:sticky;top:0;background:rgba(15,23,42,0.9);backdrop-filter:blur(8px);border-bottom:1px solid rgba(59,130,246,0.08);z-index:120}
    .nav-inner{max-width:var(--max-width);margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem}
    .brand{display:flex;align-items:center;gap:.6rem;color:#cbd5e1;font-weight:700}
    .nav-links{display:flex;gap:.5rem}
    .nav-links a{color:#cbd5e1;padding:.5rem .9rem;border-radius:8px;text-decoration:none;font-weight:600}
    .nav-links a.active{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff}
    .header{text-align:center;padding:1rem;color:#fff;background:linear-gradient(180deg,rgba(59,130,246,0.06),transparent)}
    .header h1{font-size:clamp(1.4rem,4vw,2rem);margin-bottom:.25rem;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .container{max-width:var(--max-width);margin:1.5rem auto;padding:0 1rem;display:grid;grid-template-columns:1fr minmax(260px,360px);gap:2rem}
    .left-section{display:flex;flex-direction:column;gap:1.25rem}
    textarea{width:100%;min-height:300px;padding:1.25rem;border-radius:var(--radius);border:2px solid rgba(59,130,246,0.14);background:var(--card-bg);font-family:inherit}
    .button-group{display:flex;gap:.85rem}
    .btn-check{background:linear-gradient(135deg,var(--accent-1),var(--accent-2));color:#fff;padding:.8rem 1rem;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-clear{background:rgba(255,255,255,0.08);color:#fff;padding:.8rem 1rem;border-radius:10px;border:1px solid rgba(255,255,255,0.12);cursor:pointer}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.98),#f8fafc);padding:1.15rem;border-radius:12px;box-shadow:var(--shadow-sm);border:1px solid rgba(59,130,246,0.08)}
    .file-list{max-height:320px;overflow:auto;margin-top:.6rem}
    .file-item{display:flex;justify-content:space-between;align-items:center;background:linear-gradient(135deg,#f0f9ff,#e0f2fe);padding:.6rem;border-radius:8px;margin-bottom:.5rem;font-size:.9rem;color:#0f4c75;border-left:4px solid var(--accent-1)}
    .file-item .left{display:flex;align-items:center;gap:.5rem}
    .file-item .actions{display:flex;gap:.5rem;align-items:center}
    .file-item button{padding:.35rem .6rem;border-radius:6px;border:0;font-weight:700;cursor:pointer}
    .btn-index{background:linear-gradient(135deg,#06b6d4,#3b82f6);color:#fff}
    .btn-analyze{background:linear-gradient(135deg,#3b82f6,#06b6d4);color:#fff}
    .btn-remove{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff}
    .status-badge{font-size:.8rem;padding:.15rem .5rem;border-radius:8px;background:rgba(0,0,0,0.04)}
    .error-badge{background:#ffebee;color:#b91c1c;padding:.15rem .45rem;border-radius:6px;font-size:.75rem;margin-left:.5rem}
    .muted-note{font-size:.85rem;color:#64748b;margin-top:.5rem}
    .results-card{display:none;margin-top:.75rem}
    .results-card.show{display:block}
    .result-item{padding:.9rem;background:linear-gradient(135deg,#f0f9ff,#e0f2fe);border-left:4px solid var(--accent-1);border-radius:8px;margin-bottom:.8rem;color:#0f4c75}
    @media(max-width:1024px){.container{grid-template-columns:1fr;padding:0 1rem}}
  </style>
</head>
<body>
  <div class="header"><h1>âœ¨ TextGuard Pro</h1><p style="color:#cbd5e1">Advanced Content Analysis & Verification Platform</p></div>

  <nav aria-label="Main nav">
    <div class="nav-inner">
      <div class="brand">ğŸ›¡ï¸ TextGuard</div>
      <div class="nav-links" id="primaryNav">
        <a href="#" class="nav-link active" data-section="plagiarism">ğŸ“‹ Plagiarism Checker</a>
        <a href="#" class="nav-link" data-section="ai-detector">ğŸ¤– AI Detector</a>
        <a href="#" class="nav-link" data-section="ai-humanizer">âœ¨ Humanizer</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <!-- left -->
    <section id="plagiarism" class="left-section">
      <h2 style="color:#fff">ğŸ“ Paste Your Content</h2>
      <textarea id="textInput" placeholder="Paste your text here for instant plagiarism detection..."></textarea>
      <div class="button-group">
        <button class="btn-check" id="analyzeBtn">ğŸ” Analyze</button>
        <button class="btn-clear" id="clearBtn">â†» Clear</button>
      </div>

      <div id="resultsCard" class="results-card card" aria-live="polite">
        <div style="font-weight:700;color:#0f172a;margin-bottom:.6rem">ğŸ“Š Analysis Results</div>
        <div id="resultsContent"></div>
      </div>
    </section>

    <!-- right -->
    <aside class="card" style="display:flex;flex-direction:column;gap:1rem">
      <div>
        <div style="font-weight:700;color:#0f172a;margin-bottom:.6rem">ğŸ“¤ Upload Document</div>
        <div>
          <input id="fileInput" type="file" accept=".txt,.pdf,.doc,.docx" multiple style="display:none">
          <label for="fileInput" style="display:inline-block;padding:.9rem;border-radius:10px;background:linear-gradient(135deg,#3b82f6,#06b6d4);color:#fff;cursor:pointer;font-weight:800">Choose File(s)</label>
          <div id="fileList" class="file-list"></div>
          <div class="muted-note">Files are only shown on upload. Click <strong>Index</strong> to add to corpus, or <strong>Analyze</strong> to check now.</div>
        </div>
      </div>

      <div>
        <div style="font-weight:700;color:#0f172a;margin-bottom:.6rem">ğŸ“¥ Export Report</div>
        <button id="downloadBtn" style="width:100%;padding:.8rem;border-radius:10px;border:0;font-weight:800;background:linear-gradient(135deg,#10b981,#059669);color:#fff;cursor:pointer" disabled>Download Report</button>
        <p class="muted-note">Generate detailed plagiarism analysis report (TXT)</p>
      </div>
    </aside>
  </main>

  <script>
    // ---------- CONFIG ----------
    const serverUrl = 'http://127.0.0.1:8000'; // change if your backend is elsewhere

    // ---------- STATE ----------
    // uploaded map: filename => { file: File, status: 'not-indexed'|'indexed'|'index-error', doc_id?, error? }
    const uploaded = new Map();

    // ---------- HELPERS ----------
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }
    function countWords(s){ if(!s) return 0; return s.trim().split(/\s+/).filter(Boolean).length }
    function buildReport(title,text,results){
      const ts = new Date().toLocaleString(); return ['â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•',title,'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•','',`Generated: ${ts}`,`Document Length: ${countWords(text)} words`,'','ANALYSIS RESULTS:',results,'','DOCUMENT CONTENT:','â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',text,'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€','Report generated by TextGuard Pro'].join('\n')
    }
    function downloadFile(content,filename){ const blob=new Blob([content],{type:'text/plain;charset=utf-8'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); URL.revokeObjectURL(url); a.remove(); }

    // ---------- RENDER file list (no auto-ops) ----------
    function renderFileList(){
      const container = document.getElementById('fileList'); container.innerHTML = '';
      if (uploaded.size === 0) {
        container.innerHTML = '<div style="color:#64748b">No files uploaded</div>'; return;
      }

      uploaded.forEach((meta, name) => {
        const item = document.createElement('div'); item.className = 'file-item';
        const left = document.createElement('div'); left.className = 'left'; left.innerHTML = `ğŸ“„ <strong>${escapeHtml(name)}</strong>`; item.appendChild(left);

        const actions = document.createElement('div'); actions.className = 'actions';

        // status
        const statusEl = document.createElement('span'); statusEl.className = 'status-badge';
        if (meta.status === 'indexed') statusEl.innerText = 'Indexed';
        else if (meta.status === 'index-error') statusEl.innerHTML = 'Index Error';
        else statusEl.innerText = 'Not indexed';
        actions.appendChild(statusEl);

        // Index button (explicit)
        const indexBtn = document.createElement('button'); indexBtn.className = 'btn-index'; indexBtn.innerText = 'Index';
        indexBtn.title = 'Upload this file to the local corpus (indexes for future checks)';
        indexBtn.addEventListener('click', () => indexFile(name));
        actions.appendChild(indexBtn);

        // Analyze button (explicit)
        const analyzeBtn = document.createElement('button'); analyzeBtn.className = 'btn-analyze'; analyzeBtn.innerText = 'Analyze';
        analyzeBtn.title = 'Analyze this file now (does not require indexing)';
        analyzeBtn.addEventListener('click', () => analyzeUploadedFile(name));
        actions.appendChild(analyzeBtn);

        // Remove (confirm)
        const removeBtn = document.createElement('button'); removeBtn.className = 'btn-remove'; removeBtn.innerText = 'Remove';
        removeBtn.addEventListener('click', () => {
          const ok = confirm(`Remove "${name}" from the list? This will not delete any server-indexed copy.`); // explicit
          if (ok) { uploaded.delete(name); renderFileList(); document.getElementById('downloadBtn').disabled = uploaded.size === 0; }
        });
        actions.appendChild(removeBtn);

        item.appendChild(actions);
        container.appendChild(item);
      });
    }

    // ---------- UPLOAD local show only (NO server calls) ----------
    function handleFileInputChange(e){
      const files = Array.from(e.target.files || []); if (!files.length) return;
      for (const f of files) { if (!uploaded.has(f.name)) uploaded.set(f.name, { file: f, status: 'not-indexed' }); }
      renderFileList();
      document.getElementById('downloadBtn').disabled = uploaded.size === 0;
    }

    // ---------- Index a file on demand (explicit) ----------
    async function indexFile(filename){
      const meta = uploaded.get(filename);
      if (!meta) { alert('File not found'); return; }
      const file = meta.file;
      // update UI badge
      uploaded.set(filename, { ...meta, status: 'indexing' }); renderFileList();
      try {
        const fd = new FormData(); fd.append('file', file, file.name);
        const res = await fetch(`${serverUrl}/api/index-file`, { method: 'POST', body: fd });
        const j = await res.json();
        if (res.ok && j.ok) {
          uploaded.set(filename, { ...meta, status: 'indexed', doc_id: j.doc_id });
          alert(`Indexed ${filename} (doc_id: ${j.doc_id})`);
        } else {
          uploaded.set(filename, { ...meta, status: 'index-error', error: j.error || 'Index failed' });
          alert(`Index failed for ${filename}: ${j.error || 'server error'}`);
        }
      } catch (err) {
        uploaded.set(filename, { ...meta, status: 'index-error', error: String(err) });
        alert(`Network error while indexing ${filename}. Is server running at ${serverUrl}?`);
      }
      renderFileList();
    }

    // ---------- Analyze uploaded file (explicit) ----------
    async function analyzeUploadedFile(filename){
      const meta = uploaded.get(filename);
      if (!meta) { alert('File not found'); return; }
      const file = meta.file;
      const resultsCard = document.getElementById('resultsCard'); const resultsContent = document.getElementById('resultsContent');
      resultsContent.innerHTML = `<div class="result-item">Analyzing file: ${escapeHtml(filename)} â€¦</div>`; resultsCard.classList.add('show');

      try {
        const fd = new FormData(); fd.append('file', file, file.name); fd.append('top_k','10');
        const res = await fetch(`${serverUrl}/api/check-file`, { method:'POST', body: fd });
        const j = await res.json();
        if (!res.ok || !j.ok) {
          resultsContent.innerHTML = `<div class="result-item"><strong>Error:</strong> ${j.error || 'Server error'}</div>`; return;
        }
        const matches = j.matches || [];
        if (matches.length === 0) {
          resultsContent.innerHTML = `<div class="result-item"><strong>No similar documents found in local corpus.</strong></div>`;
        } else {
          let html = `<div class="result-item"><strong>Candidates examined:</strong> ${j.candidates_count || 0}</div>`;
          matches.forEach(m => {
            html += `<div class="result-item"><strong>${escapeHtml(m.filename || m.doc_id)}</strong><br/>Similarity: <span style="color:#3b82f6">${m.percent}%</span><br/>Words: ${m.words} â— Shingles: ${m.shingles}</div>`;
          });
          resultsContent.innerHTML = html;
        }
      } catch (err) {
        console.error(err);
        resultsContent.innerHTML = `<div class="result-item"><strong>Network error. Is server running at ${serverUrl} ?</strong></div>`;
      }
    }

    // ---------- Analyze pasted text (existing) ----------
    async function checkPlagiarism() {
      const text = document.getElementById('textInput').value.trim();
      const resultsCard = document.getElementById('resultsCard'); const resultsContent = document.getElementById('resultsContent');
      if (!text) { alert('Please enter text to check'); document.getElementById('textInput').focus(); return; }
      resultsContent.innerHTML = `<div class="result-item">Analyzing... (this may take a second)</div>`; resultsCard.classList.add('show');

      try {
        const fd = new FormData(); fd.append('text', text); fd.append('top_k','10');
        const res = await fetch(`${serverUrl}/api/check-text`, { method:'POST', body: fd });
        const j = await res.json();
        if (!res.ok || !j.ok) { resultsContent.innerHTML = `<div class="result-item"><strong>Error:</strong> ${j.error || 'Server error'}</div>`; return; }
        const matches = j.matches || [];
        if (matches.length === 0) {
          resultsContent.innerHTML = `<div class="result-item"><strong>No similar documents found in local corpus.</strong></div>`;
        } else {
          let html = `<div class="result-item"><strong>Candidates examined:</strong> ${j.candidates_count || 0}</div>`;
          matches.forEach(m => {
            html += `<div class="result-item"><strong>${escapeHtml(m.filename || m.doc_id)}</strong><br/>Similarity: <span style="color:#3b82f6">${m.percent}%</span><br/>Words: ${m.words} â— Shingles: ${m.shingles}</div>`;
          });
          resultsContent.innerHTML = html;
        }
      } catch (err) {
        console.error(err);
        resultsContent.innerHTML = `<div class="result-item"><strong>Network error. Is server running at ${serverUrl} ?</strong></div>`;
      }
    }

    // ---------- UI wiring ----------
    document.getElementById('fileInput').addEventListener('change', handleFileInputChange);
    document.getElementById('analyzeBtn').addEventListener('click', checkPlagiarism);
    document.getElementById('clearBtn').addEventListener('click', () => { document.getElementById('textInput').value=''; document.getElementById('resultsCard').classList.remove('show'); });
    // initial render
    renderFileList();
  </script>
</body>
</html>
